(()=>{"use strict";var e={9618:(e,t,r)=>{r(23792),r(3362),r(69085),r(9391),r(44114),r(26099);var n=r(22856),s=r(74927),a=r.n(s),o=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[e.isAuthenticated?t("el-header",{staticClass:"header"},[t("div",{staticClass:"header-left"},[t("h1",[e._v("GiPtato 防火墙管理系统")])]),t("div",{staticClass:"header-right"},[t("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleCommand}},[t("span",{staticClass:"user-dropdown"},[e._v(" "+e._s(e.currentUser.username)+" "),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"profile"}},[e._v("个人资料")]),t("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出登录")])],1)],1)],1)]):e._e(),t("router-view")],1)},c=[],i=r(8643),u=r(1910),l=r(42332),d=r.n(l);const p={name:"App",computed:(0,i.A)({},(0,u.L8)(["isAuthenticated","currentUser"])),methods:(0,i.A)((0,i.A)({},(0,u.i0)(["logout","getCurrentUser"])),{},{handleCommand:function(e){"logout"===e?this.handleLogout():"profile"===e&&this.$router.push("/profile")},handleLogout:function(){this.logout(),this.$router.push("/login"),this.$message.success("已退出登录")}}),created:function(){var e=localStorage.getItem("token");e&&(d().defaults.headers.common["Authorization"]="Bearer ".concat(e),this.getCurrentUser())}},v=p;var m=r(81656),h=(0,m.A)(v,o,c,!1,null,null,null);const g=h.exports;r(15086),r(18111),r(13579);var f=r(1594),b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("div",{staticClass:"dashboard"},[t("el-card",{staticClass:"welcome-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("h2",[e._v("欢迎使用iPtato防火墙管理面板")])]),t("div",{staticClass:"dashboard-content"},[t("p",[e._v("通过这个面板，您可以轻松管理多台服务器的iptables防火墙规则。")]),t("ul",[t("li",[e._v("封禁/解封BT、PT协议")]),t("li",[e._v("封禁/解封垃圾邮件端口")]),t("li",[e._v("自定义封禁/解封端口和关键词")]),t("li",[e._v("管理入网端口白名单")]),t("li",[e._v("管理入网IP白名单")])]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/servers")}}},[e._v("开始管理服务器")])],1)])],1)])},w=[];const k={name:"HomeView"},x=k;var A=(0,m.A)(x,b,w,!1,null,"6336ce98",null);const I=A.exports;var S=function(){var e=this,t=e._self._c;return t("div",{staticClass:"servers-container"},[t("div",{staticClass:"page-header"},[t("h1",[e._v("服务器管理")]),t("el-button",{attrs:{type:"primary"},on:{click:e.showAddServerDialog}},[e._v("添加服务器")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.servers,border:""}},[t("el-table-column",{attrs:{prop:"name",label:"服务器名称",width:"180"}}),t("el-table-column",{attrs:{prop:"host",label:"主机地址",width:"180"}}),t("el-table-column",{attrs:{prop:"port",label:"SSH端口",width:"100"}}),t("el-table-column",{attrs:{prop:"username",label:"用户名",width:"120"}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-tag",{attrs:{type:e.getStatusTagType(r.row.status)}},[e._v(" "+e._s(e.statusText[r.row.status])+" ")]),t("el-tooltip",{attrs:{content:"刷新状态",placement:"top"}},[t("el-button",{attrs:{type:"text",icon:"el-icon-refresh",circle:"",size:"mini"},on:{click:function(t){return e.checkServerStatus(r.row)}}})],1)]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(r.row)}}},[e._v("编辑")]),"online"!==r.row.status&&"connecting"!==r.row.status&&"disconnecting"!==r.row.status?t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleConnect(r.row)}}},[e._v("连接")]):"online"===r.row.status?t("el-button",{attrs:{size:"mini",type:"warning",loading:e.disconnectingServers[r.row._id]},on:{click:function(t){return e.handleDisconnect(r.row)}}},[e._v("断开")]):t("el-button",{attrs:{size:"mini",disabled:""}},[e._v(e._s(e.statusText[r.row.status]))]),"online"===r.row.status?t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleManageRules(r.row)}}},[e._v("管理规则")]):e._e(),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r.row)}}},[e._v("删除")])]}}])})],1),t("el-dialog",{attrs:{title:e.isEdit?"编辑服务器":"添加服务器",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("server-form",{attrs:{"is-edit":e.isEdit,"server-data":e.currentServer},on:{submit:e.handleFormSubmit}})],1)],1)},P=[],y=r(27262),_=r(47546),$=r(24634),C=(r(48980),r(76031),r(62010),function(){var e=this,t=e._self._c;return t("div",{staticClass:"server-form"},[t("el-form",{ref:"serverForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"服务器名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入服务器名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"主机地址",prop:"host"}},[t("el-input",{attrs:{placeholder:"请输入主机IP或域名"},model:{value:e.form.host,callback:function(t){e.$set(e.form,"host",t)},expression:"form.host"}})],1),t("el-form-item",{attrs:{label:"SSH端口",prop:"port"}},[t("el-input-number",{attrs:{min:1,max:65535,step:1},model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",t)},expression:"form.port"}})],1),t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"认证方式",prop:"authType"}},[t("el-radio-group",{model:{value:e.form.authType,callback:function(t){e.$set(e.form,"authType",t)},expression:"form.authType"}},[t("el-radio",{attrs:{label:"password"}},[e._v("密码")]),t("el-radio",{attrs:{label:"privateKey"}},[e._v("密钥")])],1)],1),"password"===e.form.authType?t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e(),"privateKey"===e.form.authType?t("el-form-item",{attrs:{label:"私钥",prop:"privateKey"}},[t("el-input",{attrs:{type:"textarea",rows:8,placeholder:"请输入私钥内容"},model:{value:e.form.privateKey,callback:function(t){e.$set(e.form,"privateKey",t)},expression:"form.privateKey"}})],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v(e._s(e.isEdit?"更新":"添加"))]),t("el-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1)}),L=[];const T={name:"ServerForm",props:{isEdit:{type:Boolean,default:!1},serverData:{type:Object,default:function(){return{}}}},data:function(){return{form:{name:"",host:"",port:22,username:"",authType:"password",password:"",privateKey:""},rules:{name:[{required:!0,message:"请输入服务器名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],host:[{required:!0,message:"请输入主机地址",trigger:"blur"}],port:[{required:!0,message:"请输入SSH端口",trigger:"blur"},{type:"number",message:"端口必须为数字值",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],privateKey:[{required:!0,message:"请输入私钥",trigger:"blur"}]}}},created:function(){this.isEdit&&this.serverData&&(this.form=(0,i.A)((0,i.A)({},this.form),this.serverData))},methods:{submitForm:function(){var e=this;this.$refs.serverForm.validate((function(t){if(!t)return!1;e.$emit("submit",e.form)}))},resetForm:function(){this.$refs.serverForm.resetFields()}}},E=T;var O=(0,m.A)(E,C,L,!1,null,"65912c88",null);const D=O.exports,B={name:"ServersView",components:{ServerForm:D},data:function(){return{loading:!1,servers:[],dialogVisible:!1,isEdit:!1,currentServer:null,statusText:{online:"在线",offline:"离线",error:"错误",connecting:"连接中",disconnecting:"断开中"},disconnectingServers:{},statusCheckInterval:null}},created:function(){var e=this;this.fetchServers(),this.statusCheckInterval=setInterval((function(){e.checkAllServersStatus()}),3e4)},beforeDestroy:function(){this.statusCheckInterval&&clearInterval(this.statusCheckInterval)},methods:(0,i.A)((0,i.A)({},(0,u.i0)("servers",["getAllServers","createServer","updateServer","deleteServer","connectServer","disconnectServer","checkStatus"])),{},{fetchServers:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.getAllServers();case 4:r=t.sent,e.servers=r.data,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.$message.error("获取服务器列表失败: "+t.t0.message);case 11:return t.prev=11,e.loading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()},showAddServerDialog:function(){this.isEdit=!1,this.currentServer=null,this.dialogVisible=!0},handleEdit:function(e){this.isEdit=!0,this.currentServer=(0,i.A)({},e),this.dialogVisible=!0},handleFormSubmit:function(e){var t=this;return(0,$.A)((0,_.A)().mark((function r(){return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,!t.isEdit){r.next=7;break}return r.next=4,t.updateServer({id:t.currentServer._id,data:e});case 4:t.$message.success("服务器更新成功"),r.next=10;break;case 7:return r.next=9,t.createServer(e);case 9:t.$message.success("服务器添加成功");case 10:t.dialogVisible=!1,t.fetchServers(),r.next=17;break;case 14:r.prev=14,r.t0=r["catch"](0),t.$message.error(r.t0.message);case 17:case"end":return r.stop()}}),r,null,[[0,14]])})))()},handleDelete:function(e){var t=this;return(0,$.A)((0,_.A)().mark((function r(){return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$confirm("此操作将永久删除该服务器, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return r.next=5,t.deleteServer(e._id);case 5:t.$message.success("服务器删除成功"),t.fetchServers(),r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](0),"cancel"!==r.t0&&t.$message.error("删除服务器失败: "+r.t0.message);case 12:case"end":return r.stop()}}),r,null,[[0,9]])})))()},handleConnect:function(e){var t=this;return(0,$.A)((0,_.A)().mark((function r(){var n;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t.loading=!0,n=t.servers.findIndex((function(t){return t._id===e._id})),-1!==n&&t.$set(t.servers[n],"status","connecting"),r.next=6,t.connectServer(e._id);case 6:return t.$message.success("服务器连接成功"),r.next=9,t.fetchServers();case 9:r.next=16;break;case 11:return r.prev=11,r.t0=r["catch"](0),t.$message.error("连接服务器失败: "+r.t0.message),r.next=16,t.checkServerStatus(e);case 16:return r.prev=16,t.loading=!1,r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[0,11,16,19]])})))()},handleDisconnect:function(e){var t=this;return(0,$.A)((0,_.A)().mark((function r(){var n;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t.$set(t.disconnectingServers,e._id,!0),n=t.servers.findIndex((function(t){return t._id===e._id})),-1!==n&&t.$set(t.servers[n],"status","disconnecting"),r.next=6,t.disconnectServer(e._id);case 6:return t.$message.success("服务器断开连接成功"),-1!==n&&t.$set(t.servers[n],"status","offline"),r.next=10,t.fetchServers();case 10:r.next=17;break;case 12:return r.prev=12,r.t0=r["catch"](0),t.$message.error("断开服务器连接失败: "+r.t0.message),r.next=17,t.checkServerStatus(e);case 17:return r.prev=17,t.$set(t.disconnectingServers,e._id,!1),r.finish(17);case 20:case"end":return r.stop()}}),r,null,[[0,12,17,20]])})))()},handleManageRules:function(e){this.$router.push({name:"rules",params:{serverId:e._id}})},checkServerStatus:function(e){var t=this;return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.checkStatus(e._id);case 3:n=r.sent,s=t.servers.findIndex((function(t){return t._id===e._id})),-1!==s&&t.$set(t.servers[s],"status",n.data.data.status),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),console.error("检查服务器状态失败:",r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},checkAllServersStatus:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=(0,y.A)(e.servers),t.prev=1,r.s();case 3:if((n=r.n()).done){t.next=9;break}return s=n.value,t.next=7,e.checkServerStatus(s);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1),r.e(t.t0);case 14:return t.prev=14,r.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})))()},getStatusTagType:function(e){switch(e){case"online":return"success";case"error":return"danger";case"connecting":return"info";case"disconnecting":return"warning";default:return""}}})},F=B;var U=(0,m.A)(F,S,P,!1,null,"6e7e9e6e",null);const V=U.exports;r(74423),r(21699);var z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"rules-container"},[t("div",{staticClass:"page-header"},[t("h1",[e._v("防火墙规则管理")]),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/servers")}}},[e._v("返回服务器列表")]),e.isServerOnline?t("el-button",{attrs:{type:"success",loading:e.deploying},on:{click:e.deployIptatoScript}},[e._v("部署脚本")]):e._e(),e.isServerOnline?t("el-button",{attrs:{type:"danger"},on:{click:e.confirmClearRules}},[e._v("清空所有规则")]):e._e(),!e.isServerOnline&&e.server?t("el-button",{attrs:{type:"warning",loading:e.connecting},on:{click:e.tryConnectServer}},[e._v("连接服务器")]):e._e()],1)]),e.server?t("div",{staticClass:"server-info"},[t("h2",[e._v(e._s(e.server.name)+" "),t("el-tag",{attrs:{type:"online"===e.server.status?"success":"danger"}},[e._v(e._s("online"===e.server.status?"在线":"离线"))])],1),t("p",[e._v(e._s(e.server.host)+":"+e._s(e.server.port)+" ("+e._s(e.server.username)+")")])]):e._e(),t("el-tabs",{attrs:{type:"card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"出网控制",name:"outbound"}},[e.isServerOnline?t("div",[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("当前封禁列表")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.refreshBlockList}},[e._v("刷新")])],1),e.blockList?t("pre",{staticClass:"output"},[e._v(e._s(e.blockList))]):t("div",[e._v("加载中...")])]),t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("封禁管理")])]),t("el-button-group",[t("el-button",{attrs:{type:"primary",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.blockBTPT}},[e._v("封禁BT/PT")]),t("el-button",{attrs:{type:"primary",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.blockSPAM}},[e._v("封禁SPAM")]),t("el-button",{attrs:{type:"primary",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.blockAll}},[e._v("封禁全部")])],1),t("el-divider"),t("el-form",{attrs:{inline:!0},nativeOn:{submit:function(t){return t.preventDefault(),e.blockCustomPorts.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"自定义端口"}},[t("el-input",{attrs:{placeholder:"如: 6881,6882-6889",disabled:!e.isServerOnline},model:{value:e.customPorts,callback:function(t){e.customPorts=t},expression:"customPorts"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"warning",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.blockCustomPorts}},[e._v("封禁")])],1)],1),t("el-form",{attrs:{inline:!0},nativeOn:{submit:function(t){return t.preventDefault(),e.blockCustomKeyword.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"自定义关键词"}},[t("el-input",{attrs:{placeholder:"如: youtube.com",disabled:!e.isServerOnline},model:{value:e.customKeyword,callback:function(t){e.customKeyword=t},expression:"customKeyword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"warning",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.blockCustomKeyword}},[e._v("封禁")])],1)],1)],1),t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("解封管理")])]),t("el-button-group",[t("el-button",{attrs:{type:"success",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.unblockBTPT}},[e._v("解封BT/PT")]),t("el-button",{attrs:{type:"success",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.unblockSPAM}},[e._v("解封SPAM")]),t("el-button",{attrs:{type:"success",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.unblockAll}},[e._v("解封全部")])],1),t("el-divider"),t("el-form",{attrs:{inline:!0},nativeOn:{submit:function(t){return t.preventDefault(),e.unblockCustomPorts.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"自定义端口"}},[t("el-input",{attrs:{placeholder:"如: 6881,6882-6889",disabled:!e.isServerOnline},model:{value:e.customUnblockPorts,callback:function(t){e.customUnblockPorts=t},expression:"customUnblockPorts"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"success",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.unblockCustomPorts}},[e._v("解封")])],1)],1),t("el-form",{attrs:{inline:!0},nativeOn:{submit:function(t){return t.preventDefault(),e.unblockCustomKeyword.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"自定义关键词"}},[t("el-input",{attrs:{placeholder:"如: youtube.com",disabled:!e.isServerOnline},model:{value:e.customUnblockKeyword,callback:function(t){e.customUnblockKeyword=t},expression:"customUnblockKeyword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"success",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.unblockCustomKeyword}},[e._v("解封")])],1)],1),t("el-button",{attrs:{type:"success",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.unblockAllKeywords}},[e._v("解封所有关键词")])],1)],1):[t("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{title:"服务器当前处于离线状态",type:"warning",description:"服务器离线时无法管理防火墙规则，请先连接服务器","show-icon":"",closable:!1}}),t("div",{staticClass:"server-offline"},[t("i",{staticClass:"el-icon-connection"}),t("h3",[e._v("服务器未连接")]),t("p",[e._v("当前无法管理防火墙规则，请先连接服务器")])]),t("div",{staticClass:"offline-actions"},[t("el-button",{attrs:{type:"primary",loading:e.connecting,icon:"el-icon-refresh"},on:{click:e.tryConnectServer}},[e._v("连接服务器")]),t("el-button",{attrs:{icon:"el-icon-back"},on:{click:function(t){return e.$router.push("/servers")}}},[e._v("返回服务器列表")])],1)]],2),t("el-tab-pane",{attrs:{label:"入网控制",name:"inbound"}},[e.isServerOnline?t("div",[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("SSH端口状态")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.refreshSSHPort}},[e._v("刷新")])],1),e.sshPortStatus?t("pre",{staticClass:"output"},[e._v(e._s(e.sshPortStatus))]):t("div",[e._v("加载中...")])]),t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("入网端口管理")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.refreshInboundPorts}},[e._v("刷新")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingPorts,expression:"loadingPorts"}],staticStyle:{width:"100%"},attrs:{data:e.inboundPorts}},[t("el-table-column",{attrs:{prop:"port",label:"端口",width:"180"}}),t("el-table-column",{attrs:{prop:"protocol",label:"协议",width:"100"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(r){return[e.isSshPort(r.row.port)?t("el-tooltip",{attrs:{content:"不能取消SSH端口放行，这可能导致无法连接服务器",placement:"top"}},[t("el-button",{attrs:{type:"danger",size:"mini",disabled:""}},[e._v("取消放行")])],1):t("el-button",{attrs:{type:"danger",size:"mini",disabled:!e.isServerOnline},on:{click:function(t){return e.disallowPort(r.row.port)}}},[e._v("取消放行")])]}}])})],1),t("el-divider"),t("el-form",{attrs:{inline:!0},nativeOn:{submit:function(t){return t.preventDefault(),e.allowPort.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"放行端口"}},[t("el-input",{attrs:{placeholder:"如: 80,443",disabled:!e.isServerOnline},model:{value:e.portToAllow,callback:function(t){e.portToAllow=t},expression:"portToAllow"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.allowPort}},[e._v("添加")])],1)],1)],1),t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("入网IP管理")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.refreshInboundIPs}},[e._v("刷新")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingIPs,expression:"loadingIPs"}],staticStyle:{width:"100%"},attrs:{data:e.inboundIPs}},[t("el-table-column",{attrs:{prop:"ip",label:"IP地址",width:"180"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{type:"danger",size:"mini",disabled:!e.isServerOnline},on:{click:function(t){return e.disallowIP(r.row.ip||r.row)}}},[e._v("取消放行")])]}}])})],1),t("el-divider"),t("el-form",{attrs:{inline:!0},nativeOn:{submit:function(t){return t.preventDefault(),e.allowIP.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"放行IP"}},[t("el-input",{attrs:{placeholder:"如: 192.168.1.1",disabled:!e.isServerOnline},model:{value:e.ipToAllow,callback:function(t){e.ipToAllow=t},expression:"ipToAllow"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loading,disabled:!e.isServerOnline},on:{click:e.allowIP}},[e._v("添加")])],1)],1)],1)],1):[t("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{title:"服务器当前处于离线状态",type:"warning",description:"服务器离线时无法管理防火墙规则，请先连接服务器","show-icon":"",closable:!1}}),t("div",{staticClass:"server-offline"},[t("i",{staticClass:"el-icon-connection"}),t("h3",[e._v("服务器未连接")]),t("p",[e._v("当前无法管理防火墙规则，请先连接服务器")])]),t("div",{staticClass:"offline-actions"},[t("el-button",{attrs:{type:"primary",loading:e.connecting,icon:"el-icon-refresh"},on:{click:e.tryConnectServer}},[e._v("连接服务器")]),t("el-button",{attrs:{icon:"el-icon-back"},on:{click:function(t){return e.$router.push("/servers")}}},[e._v("返回服务器列表")])],1)]],2)],1),e.commandOutput?t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("命令输出")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.clearCommandOutput}},[e._v("清空")])],1),t("pre",{class:["output",{"output-error":e.commandOutput.includes("失败")||e.commandOutput.includes("错误")}]},[e._v(e._s(e.commandOutput))]),e.commandOutput.includes("status code 500")?t("div",{staticClass:"error-solution"},[t("el-alert",{attrs:{title:"发现服务器内部错误(500)",type:"error",description:"服务器内部错误可能由多种原因导致，建议尝试以下解决方案：","show-icon":"",closable:!1}}),t("el-collapse",{staticStyle:{"margin-top":"10px"}},[t("el-collapse-item",{attrs:{title:"可能的解决方案",name:"1"}},[t("ol",[t("li",[e._v("检查服务器连接状态，确保SSH可以正常连接")]),t("li",[e._v("尝试手动部署脚本按钮，绕过自动部署流程")]),t("li",[e._v("检查服务器磁盘空间是否足够")]),t("li",[e._v("查看服务器日志文件 (/var/log/syslog 或 /var/log/messages)")]),t("li",[e._v("尝试在服务器上手动执行以下命令:")]),t("pre",{staticClass:"command-example"},[e._v("wget -N --no-check-certificate https://raw.githubusercontent.com/Fiftonb/GiPtato/refs/heads/main/iPtato.sh && chmod +x iPtato.sh && bash iPtato.sh")]),t("li",[e._v("如仍无法解决，请联系管理员或提交详细错误报告")])])])],1)],1):e._e()]):e._e(),e.isInitialized?e._e():t("el-card",{staticClass:"initialization-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("初始化检查")])]),t("el-steps",{attrs:{active:e.initStepActive,"finish-status":"success"}},e._l(e.initializationSteps,(function(e,r){return t("el-step",{key:r,attrs:{title:e.name}})})),1),t("div",{staticClass:"initialization-actions",staticStyle:{"margin-top":"20px"}},[1===e.initStepActive?t("el-button",{attrs:{type:"primary",loading:e.connecting},on:{click:e.connectServer}},[e._v("连接服务器")]):e._e(),2===e.initStepActive?t("el-button",{attrs:{type:"primary",loading:e.deploying},on:{click:e.checkInitialization}},[e._v("自动部署脚本")]):e._e(),2===e.initStepActive?t("el-button",{attrs:{type:"warning",loading:e.deploying},on:{click:e.deployIptatoManually}},[e._v("手动部署脚本")]):e._e(),3===e.initStepActive?t("el-button",{attrs:{type:"primary"},on:{click:e.completeInitialization}},[e._v("加载规则")]):e._e(),t("el-button",{attrs:{type:"danger",loading:e.loading},on:{click:e.manualInitialize}},[e._v("跳过检查直接初始化")])],1),e.commandOutput&&e.commandOutput.includes("脚本部署失败")?t("div",{staticClass:"error-info",staticStyle:{"margin-top":"15px",color:"#F56C6C"}},[t("p",[e._v("部署失败原因可能包括：")]),t("ul",[t("li",[e._v("服务器连接不稳定")]),t("li",[e._v("服务器配置问题")]),t("li",[e._v("网络限制阻止了脚本下载")])]),t("p",[e._v("建议尝试：")]),t("ul",[t("li",[e._v('点击"手动部署脚本"按钮')]),t("li",[e._v("检查服务器连接状态")]),t("li",[e._v("查看服务器日志获取详细信息")])])]):e._e()],1),t("el-card",{staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("调试工具")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.debugInfo=""}}},[e._v("清空")])],1),t("el-button",{attrs:{type:"warning",loading:e.debugging},on:{click:e.checkScriptExistence}},[e._v("检查脚本存在")]),t("el-button",{attrs:{type:"warning",loading:e.debugging},on:{click:e.testServerConnection}},[e._v("测试服务器连接")]),t("el-button",{attrs:{type:"danger",loading:e.debugging},on:{click:e.resetConnectionState}},[e._v("重置连接状态")]),t("el-button",{attrs:{type:"primary",loading:e.debugging},on:{click:e.generateManualCommands}},[e._v("生成手动执行命令")]),e.debugInfo?t("div",{staticClass:"debug-info",staticStyle:{"margin-top":"15px"}},[t("h4",[e._v("调试信息：")]),t("pre",[e._v(e._s(e.debugInfo))])]):e._e()],1)],1)},K=[],H=r(45929),R=r(15060);r(16280),r(76918),r(28706),r(51629),r(64346),r(62062),r(59089),r(60739),r(23288),r(7588),r(61701),r(33110),r(79432),r(58940),r(27495),r(38781),r(31415),r(17642),r(58004),r(33853),r(45876),r(32475),r(15024),r(31698),r(47764),r(71761),r(23500),r(62953);const N={name:"RulesView",props:{serverId:{type:String,required:!0}},data:function(){return{activeTab:"outbound",loading:!1,deploying:!1,connecting:!1,loadingPorts:!1,loadingIPs:!1,server:null,blockList:"",sshPortStatus:"",sshPort:null,inboundPorts:[],inboundIPs:[],commandOutput:"",customPorts:"",customKeyword:"",customUnblockPorts:"",customUnblockKeyword:"",portToAllow:"",ipToAllow:"",isInitialized:!1,initStepActive:0,initializationSteps:[{name:"检查状态",done:!1},{name:"连接服务器",done:!1},{name:"部署脚本",done:!1},{name:"加载规则",done:!1}],debugging:!1,debugInfo:"",statusCheckTimer:null,dataCache:{blockList:null,sshPortStatus:null,inboundPorts:null,inboundIPs:null},cacheTTL:3e4,cacheTimestamps:{blockList:0,sshPortStatus:0,inboundPorts:0,inboundIPs:0},dataLoaded:{blockList:!1,sshPortStatus:!1,inboundPorts:!1,inboundIPs:!1},serverCacheAvailable:!1,serverCacheLastUpdate:null}},computed:(0,i.A)((0,i.A)({},(0,u.L8)("servers",["getLoading"])),{},{hasValidServerId:function(){return!!this.serverId&&"undefined"!==this.serverId},isServerOnline:function(){return this.server&&"online"===this.server.status}}),beforeRouteEnter:function(e,t,r){e.params.serverId?r():r((function(e){e.$message.error("未指定服务器ID，请先选择服务器"),e.$router.push("/servers")}))},created:function(){var e=this;this.activeTab="outbound",this.hasValidServerId?(this.$nextTick((0,$.A)((0,_.A)().mark((function t(){return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.autoResetConnectionState();case 2:return t.next=4,e.checkInitialization();case 4:case"end":return t.stop()}}),t)})))),this.startServerStatusCheck()):(this.commandOutput="服务器ID无效，请返回服务器列表重新选择服务器",this.$message.error("服务器ID无效"))},beforeDestroy:function(){this.stopServerStatusCheck()},methods:(0,i.A)((0,i.A)((0,i.A)({},(0,u.i0)("servers",["getServer","deployIptato","connectServer"])),(0,u.i0)("rules",["getBlockList","blockBTPTAction","blockSPAMAction","blockAllAction","blockCustomPortsAction","blockCustomKeywordAction","unblockBTPTAction","unblockSPAMAction","unblockAllAction","unblockCustomPortsAction","unblockCustomKeywordAction","unblockAllKeywordsAction","getInboundPorts","getInboundIPs","allowInboundPortsAction","disallowInboundPortsAction","allowInboundIPsAction","disallowInboundIPsAction","getSSHPort","clearAllRulesAction","getServerCache","getCacheLastUpdate","clearServerCache","updateCacheItem"])),{},{checkInitialization:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s,a,o;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.hasValidServerId){t.next=5;break}return e.commandOutput="错误：未指定服务器ID，请返回服务器列表选择服务器",e.$message.error("未指定服务器ID"),t.abrupt("return",!1);case 5:return e.resetInitSteps(),e.isInitialized=!1,e.initStepActive=0,e.commandOutput="正在检查服务器状态...",e.loading=!0,t.next=12,e.getServer(e.serverId);case 12:if(r=t.sent,r&&r.success){t.next=15;break}throw new Error((null===r||void 0===r?void 0:r.error)||"获取服务器信息失败");case 15:return e.server=r.data,e.initializationSteps[0].done=!0,e.initStepActive=1,t.next=20,e.loadServerCache();case 20:if(n=t.sent,n&&(e.commandOutput+="\n已成功加载服务器缓存数据"),e.server.status&&"online"===e.server.status){t.next=47;break}return e.commandOutput+="\n服务器未连接，正在尝试连接...",e.connecting=!0,t.next=27,e.connectServer(e.serverId);case 27:if(s=t.sent,e.connecting=!1,s&&s.success){t.next=44;break}if(!n){t.next=43;break}return e.$message.warning("服务器连接失败，将使用缓存数据"),e.commandOutput+="\n服务器连接失败，将使用缓存数据",e.initializationSteps[1].done=!0,e.initStepActive=2,e.initializationSteps[2].done=!0,e.initStepActive=3,e.initializationSteps[3].done=!0,e.isInitialized=!0,e.loading=!1,t.abrupt("return",!0);case 43:throw new Error((null===s||void 0===s?void 0:s.error)||"连接服务器失败");case 44:e.commandOutput+="\n服务器连接成功",t.next=50;break;case 47:e.commandOutput+="\n服务器已连接，跳过连接步骤",e.initializationSteps[1].done=!0,e.initStepActive=2;case 50:if(n&&!e.deploying){t.next=79;break}return e.commandOutput+="\n检查脚本部署情况...",e.deploying=!0,t.prev=53,t.next=56,e.deployIptato(e.serverId);case 56:if(a=t.sent,e.deploying=!1,a&&a.success){t.next=64;break}throw o=(null===a||void 0===a?void 0:a.error)||"脚本部署失败",e.commandOutput+="\n脚本部署失败: ".concat(o),(o.includes("500")||o.includes("内部错误"))&&(e.commandOutput+="\n服务器内部错误，可能原因：",e.commandOutput+="\n1. 服务器磁盘空间不足",e.commandOutput+="\n2. 服务器防火墙限制了文件上传",e.commandOutput+="\n3. 服务器缺少必要的依赖包",e.commandOutput+="\n\n建议操作：",e.commandOutput+="\n- 检查服务器连接状态",e.commandOutput+="\n- 查看服务器日志获取详细错误信息",e.commandOutput+="\n- 尝试手动连接服务器并安装依赖"),e.$message.error("脚本部署失败: ".concat(o)),new Error(o);case 64:e.commandOutput+="\n脚本部署成功",t.next=77;break;case 67:if(t.prev=67,t.t0=t["catch"](53),e.deploying=!1,e.commandOutput+="\n脚本部署过程中出错: ".concat(t.t0.message),!n){t.next=76;break}e.$message.warning("脚本部署失败，将使用缓存数据"),e.commandOutput+="\n将使用缓存数据继续",t.next=77;break;case 76:throw t.t0;case 77:t.next=80;break;case 79:e.commandOutput+="\n使用已有缓存数据，跳过脚本部署检查";case 80:return e.initializationSteps[2].done=!0,e.initStepActive=3,e.initializationSteps[3].done=!0,e.isInitialized=!0,e.loading=!1,e.isServerOnline&&(e.dataLoaded.blockList||setTimeout((function(){return e.refreshBlockList()}),0),e.dataLoaded.sshPortStatus||setTimeout((function(){return e.refreshSSHPort()}),800),e.dataLoaded.inboundPorts||setTimeout((function(){return e.refreshInboundPorts()}),1600),e.dataLoaded.inboundIPs||setTimeout((function(){return e.refreshInboundIPs()}),2400)),t.abrupt("return",!0);case 89:return t.prev=89,t.t1=t["catch"](0),e.loading=!1,e.deploying=!1,e.connecting=!1,e.commandOutput+="\n初始化失败: ".concat(t.t1.message),e.$message.error("初始化失败: ".concat(t.t1.message)),t.abrupt("return",!1);case 97:case"end":return t.stop()}}),t,null,[[0,89],[53,67]])})))()},resetInitSteps:function(){this.initializationSteps.forEach((function(e){return e.done=!1}))},refreshBlockList:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法获取阻止列表"),t.abrupt("return");case 3:if(r=Date.now(),!(e.dataCache.blockList&&r-e.cacheTimestamps.blockList<e.cacheTTL)){t.next=8;break}return e.blockList=e.dataCache.blockList,console.log("使用缓存的阻止列表数据"),t.abrupt("return");case 8:return t.prev=8,e.loading=!0,t.next=12,e.getBlockList(e.serverId);case 12:if(n=t.sent,!n||!n.success){t.next=22;break}return e.blockList=n.data||"无阻止列表数据",e.dataCache.blockList=e.blockList,e.cacheTimestamps.blockList=r,e.dataLoaded.blockList=!0,t.next=20,e.updateServerCacheItem("blockList",e.blockList);case 20:t.next=24;break;case 22:e.$message.warning((null===n||void 0===n?void 0:n.error)||"获取阻止列表失败"),e.blockList="获取阻止列表失败";case 24:t.next=30;break;case 26:t.prev=26,t.t0=t["catch"](8),e.$message.error("获取阻止列表错误: ".concat(t.t0.message)),e.blockList="获取失败: ".concat(t.t0.message);case 30:return t.prev=30,e.loading=!1,t.finish(30);case 33:case"end":return t.stop()}}),t,null,[[8,26,30,33]])})))()},refreshSSHPort:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s,a;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法获取SSH端口"),t.abrupt("return");case 3:if(r=Date.now(),!(e.dataCache.sshPortStatus&&r-e.cacheTimestamps.sshPortStatus<e.cacheTTL)){t.next=8;break}return e.sshPortStatus=e.dataCache.sshPortStatus,console.log("使用缓存的SSH端口数据"),t.abrupt("return");case 8:return t.prev=8,e.loading=!0,t.next=12,e.getSSHPort(e.serverId);case 12:if(n=t.sent,!n||!n.success){t.next=23;break}return e.sshPortStatus=n.data||"无SSH端口数据",e.dataCache.sshPortStatus=e.sshPortStatus,e.cacheTimestamps.sshPortStatus=r,e.dataLoaded.sshPortStatus=!0,t.next=20,e.updateServerCacheItem("sshPortStatus",e.sshPortStatus);case 20:try{s=n.data,s&&"string"===typeof s&&(a=s.match(/SSH端口\s*[:：]\s*(\d+)/i)||s.match(/端口\s*[:：]\s*(\d+)/i)||s.match(/port\s*[:：]\s*(\d+)/i),a&&a[1]&&(e.sshPort=parseInt(a[1],10),console.log("已识别SSH端口: ".concat(e.sshPort))))}catch(o){console.error("解析SSH端口数据出错:",o),e.server&&e.server.port&&(e.sshPort=e.server.port,console.log("使用服务器配置的端口: ".concat(e.sshPort)))}t.next=25;break;case 23:e.$message.warning((null===n||void 0===n?void 0:n.error)||"获取SSH端口失败"),e.sshPortStatus="获取SSH端口失败";case 25:t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](8),e.$message.error("获取SSH端口错误: ".concat(t.t0.message)),e.sshPortStatus="获取失败: ".concat(t.t0.message);case 31:return t.prev=31,e.loading=!1,t.finish(31);case 34:case"end":return t.stop()}}),t,null,[[8,27,31,34]])})))()},refreshInboundPorts:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s,a,o;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法获取入网端口"),t.abrupt("return");case 3:if(r=Date.now(),!(e.dataCache.inboundPorts&&r-e.cacheTimestamps.inboundPorts<e.cacheTTL)){t.next=8;break}return e.inboundPorts=e.dataCache.inboundPorts,console.log("使用缓存的入网端口数据"),t.abrupt("return");case 8:return t.prev=8,e.loadingPorts=!0,t.next=12,e.getInboundPorts(e.serverId);case 12:if(n=t.sent,!n||!n.success){t.next=27;break}return s=n.data||{tcp:[],udp:[]},a=(0,R.A)(new Set([].concat((0,R.A)(s.tcp||[]),(0,R.A)(s.udp||[])))),o=a.map((function(e){return{port:e,protocol:"TCP|UDP"}})),console.log("处理后的端口数据:",o),e.inboundPorts=o,e.dataCache.inboundPorts=o,e.cacheTimestamps.inboundPorts=r,e.dataLoaded.inboundPorts=!0,t.next=24,e.updateServerCacheItem("inboundPorts",n.data||{tcp:[],udp:[]});case 24:0===o.length?e.commandOutput="当前无放行端口":e.commandOutput="成功获取端口列表，共 ".concat(o.length," 个端口"),t.next=30;break;case 27:e.$message.warning((null===n||void 0===n?void 0:n.error)||"获取入网端口失败"),e.inboundPorts=[],e.commandOutput="获取入网端口失败: ".concat((null===n||void 0===n?void 0:n.error)||"未知错误");case 30:t.next=37;break;case 32:t.prev=32,t.t0=t["catch"](8),e.$message.error("获取入网端口错误: ".concat(t.t0.message)),e.inboundPorts=[],e.commandOutput="获取入网端口错误: ".concat(t.t0.message);case 37:return t.prev=37,e.loadingPorts=!1,t.finish(37);case 40:case"end":return t.stop()}}),t,null,[[8,32,37,40]])})))()},refreshInboundIPs:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法获取入网IP"),t.abrupt("return");case 3:if(r=Date.now(),!(e.dataCache.inboundIPs&&r-e.cacheTimestamps.inboundIPs<e.cacheTTL)){t.next=8;break}return e.inboundIPs=e.dataCache.inboundIPs,console.log("使用缓存的入网IP数据"),t.abrupt("return");case 8:return t.prev=8,e.loadingIPs=!0,t.next=12,e.getInboundIPs(e.serverId);case 12:if(n=t.sent,n&&n.success){t.next=18;break}return n&&n.error&&n.error.includes("连接")?(e.$message.error("服务器连接失败，请检查连接设置"),e.resetInitSteps(),e.isInitialized=!1):n&&n.error&&n.error.includes("脚本")?(e.$message.error("脚本部署失败，请重新初始化"),e.resetInitSteps(),e.isInitialized=!1):e.$message.warning((null===n||void 0===n?void 0:n.error)||"获取入网IP失败"),e.inboundIPs=[],e.commandOutput="获取入网IP失败: ".concat((null===n||void 0===n?void 0:n.error)||"未知错误"),t.abrupt("return");case 18:if(s=n.data||[],!Array.isArray(s)){t.next=29;break}return e.inboundIPs=s.map((function(e){return"string"===typeof e?{ip:e}:e})),e.dataCache.inboundIPs=e.inboundIPs,e.cacheTimestamps.inboundIPs=r,e.dataLoaded.inboundIPs=!0,t.next=26,e.updateServerCacheItem("inboundIPs",n.data||[]);case 26:0===s.length?e.commandOutput="当前无放行IP":e.commandOutput="成功获取IP列表，共 ".concat(s.length," 个IP"),t.next=32;break;case 29:e.$message.warning("IP数据格式无法识别"),e.inboundIPs=[],e.commandOutput="获取到的IP数据格式无法识别";case 32:t.next=39;break;case 34:t.prev=34,t.t0=t["catch"](8),e.$message.error("获取入网IP错误: ".concat(t.t0.message)),e.inboundIPs=[],e.commandOutput="获取入网IP错误: ".concat(t.t0.message);case 39:return t.prev=39,e.loadingIPs=!1,t.finish(39);case 42:case"end":return t.stop()}}),t,null,[[8,34,39,42]])})))()},executeTestCommand:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=4;break}return e.commandOutput="错误：未指定服务器ID，无法执行命令",e.$message.error("未指定服务器ID"),t.abrupt("return");case 4:case"end":return t.stop()}}),t)})))()},blockBTPT:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行阻止操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.blockBTPTAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=15;break}return e.$message.success("成功阻止BT/PT流量"),e.invalidateCache("blockList"),t.next=13,e.refreshBlockList();case 13:t.next=16;break;case 15:e.$message.error((null===r||void 0===r?void 0:r.error)||"阻止BT/PT失败");case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),e.$message.error("阻止BT/PT错误: ".concat(t.t0.message));case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,18,21,24]])})))()},blockSPAM:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行阻止操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.blockSPAMAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=15;break}return e.$message.success("成功阻止垃圾邮件流量"),e.invalidateCache("blockList"),t.next=13,e.refreshBlockList();case 13:t.next=16;break;case 15:e.$message.error((null===r||void 0===r?void 0:r.error)||"阻止垃圾邮件失败");case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),e.$message.error("阻止垃圾邮件错误: ".concat(t.t0.message));case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,18,21,24]])})))()},blockAll:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行阻止操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.blockAllAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=15;break}return e.$message.success("成功阻止所有流量"),e.invalidateCache("blockList"),t.next=13,e.refreshBlockList();case 13:t.next=16;break;case 15:e.$message.error((null===r||void 0===r?void 0:r.error)||"阻止所有流量失败");case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),e.$message.error("阻止所有流量错误: ".concat(t.t0.message));case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,18,21,24]])})))()},blockCustomPorts:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行阻止操作"),t.abrupt("return");case 3:if(e.customPorts){t.next=6;break}return e.$message.warning("请输入要阻止的端口"),t.abrupt("return");case 6:return t.prev=6,e.loading=!0,t.next=10,e.blockCustomPortsAction({serverId:e.serverId,ports:e.customPorts});case 10:if(r=t.sent,!r||!r.success){t.next=19;break}return e.$message.success("成功阻止端口: ".concat(e.customPorts)),e.customPorts="",e.invalidateCache("blockList"),t.next=17,e.refreshBlockList();case 17:t.next=20;break;case 19:e.$message.error((null===r||void 0===r?void 0:r.error)||"阻止自定义端口失败");case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](6),e.$message.error("阻止自定义端口错误: ".concat(t.t0.message));case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[6,22,25,28]])})))()},blockCustomKeyword:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行阻止操作"),t.abrupt("return");case 3:if(e.customKeyword){t.next=6;break}return e.$message.warning("请输入要阻止的关键词"),t.abrupt("return");case 6:return t.prev=6,e.loading=!0,t.next=10,e.blockCustomKeywordAction({serverId:e.serverId,keyword:e.customKeyword});case 10:if(r=t.sent,!r||!r.success){t.next=19;break}return e.$message.success("成功阻止关键词: ".concat(e.customKeyword)),e.customKeyword="",e.invalidateCache("blockList"),t.next=17,e.refreshBlockList();case 17:t.next=20;break;case 19:e.$message.error((null===r||void 0===r?void 0:r.error)||"阻止自定义关键词失败");case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](6),e.$message.error("阻止自定义关键词错误: ".concat(t.t0.message));case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[6,22,25,28]])})))()},unblockBTPT:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行取消阻止操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.unblockBTPTAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=15;break}return e.$message.success("成功取消阻止BT/PT流量"),e.invalidateCache("blockList"),t.next=13,e.refreshBlockList();case 13:t.next=16;break;case 15:e.$message.error((null===r||void 0===r?void 0:r.error)||"取消阻止BT/PT失败");case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),e.$message.error("取消阻止BT/PT错误: ".concat(t.t0.message));case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,18,21,24]])})))()},unblockSPAM:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行取消阻止操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.unblockSPAMAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=15;break}return e.$message.success("成功取消阻止垃圾邮件流量"),e.invalidateCache("blockList"),t.next=13,e.refreshBlockList();case 13:t.next=16;break;case 15:e.$message.error((null===r||void 0===r?void 0:r.error)||"取消阻止垃圾邮件失败");case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),e.$message.error("取消阻止垃圾邮件错误: ".concat(t.t0.message));case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,18,21,24]])})))()},unblockAll:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行取消阻止操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.unblockAllAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=15;break}return e.$message.success("成功取消阻止所有流量"),e.invalidateCache("blockList"),t.next=13,e.refreshBlockList();case 13:t.next=16;break;case 15:e.$message.error((null===r||void 0===r?void 0:r.error)||"取消阻止所有流量失败");case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),e.$message.error("取消阻止所有流量错误: ".concat(t.t0.message));case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,18,21,24]])})))()},unblockCustomPorts:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行取消阻止操作"),t.abrupt("return");case 3:if(e.customUnblockPorts){t.next=6;break}return e.$message.warning("请输入要取消阻止的端口"),t.abrupt("return");case 6:return t.prev=6,e.loading=!0,t.next=10,e.unblockCustomPortsAction({serverId:e.serverId,ports:e.customUnblockPorts});case 10:if(r=t.sent,!r||!r.success){t.next=19;break}return e.$message.success("成功取消阻止端口: ".concat(e.customUnblockPorts)),e.customUnblockPorts="",e.invalidateCache("blockList"),t.next=17,e.refreshBlockList();case 17:t.next=20;break;case 19:e.$message.error((null===r||void 0===r?void 0:r.error)||"取消阻止自定义端口失败");case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](6),e.$message.error("取消阻止自定义端口错误: ".concat(t.t0.message));case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[6,22,25,28]])})))()},unblockCustomKeyword:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行取消阻止操作"),t.abrupt("return");case 3:if(e.customUnblockKeyword){t.next=6;break}return e.$message.warning("请输入要取消阻止的关键词"),t.abrupt("return");case 6:return t.prev=6,e.loading=!0,t.next=10,e.unblockCustomKeywordAction({serverId:e.serverId,keyword:e.customUnblockKeyword});case 10:if(r=t.sent,!r||!r.success){t.next=19;break}return e.$message.success("成功取消阻止关键词: ".concat(e.customUnblockKeyword)),e.customUnblockKeyword="",e.invalidateCache("blockList"),t.next=17,e.refreshBlockList();case 17:t.next=20;break;case 19:e.$message.error((null===r||void 0===r?void 0:r.error)||"取消阻止自定义关键词失败");case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](6),e.$message.error("取消阻止自定义关键词错误: ".concat(t.t0.message));case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[6,22,25,28]])})))()},unblockAllKeywords:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行取消阻止操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.unblockAllKeywordsAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=15;break}return e.$message.success("成功取消阻止所有关键词"),e.invalidateCache("blockList"),t.next=13,e.refreshBlockList();case 13:t.next=16;break;case 15:e.$message.error((null===r||void 0===r?void 0:r.error)||"取消阻止所有关键词失败");case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),e.$message.error("取消阻止所有关键词错误: ".concat(t.t0.message));case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,18,21,24]])})))()},allowPort:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行允许入网操作"),t.abrupt("return");case 3:if(e.portToAllow){t.next=6;break}return e.$message.warning("请输入要允许的端口"),t.abrupt("return");case 6:return t.prev=6,e.loading=!0,t.next=10,e.allowInboundPortsAction({serverId:e.serverId,ports:e.portToAllow});case 10:if(r=t.sent,!r||!r.success){t.next=19;break}return e.$message.success("成功允许入网端口: ".concat(e.portToAllow)),e.portToAllow="",e.invalidateCache("inboundPorts"),t.next=17,e.refreshInboundPorts();case 17:t.next=20;break;case 19:e.$message.error((null===r||void 0===r?void 0:r.error)||"允许入网端口失败");case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](6),e.$message.error("允许入网端口错误: ".concat(t.t0.message));case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[6,22,25,28]])})))()},disallowPort:function(e){var t=this;return(0,$.A)((0,_.A)().mark((function r(){var n;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.hasValidServerId){r.next=3;break}return t.$message.error("未指定服务器ID，无法执行取消放行操作"),r.abrupt("return");case 3:if(!t.isSshPort(e)){r.next=6;break}return t.$message.error("不能取消SSH端口的放行，这可能导致无法连接服务器"),r.abrupt("return");case 6:return r.prev=6,t.loading=!0,r.next=10,t.disallowInboundPortsAction({serverId:t.serverId,ports:e.toString()});case 10:if(n=r.sent,!n||!n.success){r.next=18;break}return t.$message.success("成功取消放行端口: ".concat(e)),t.invalidateCache("inboundPorts"),r.next=16,t.refreshInboundPorts();case 16:r.next=19;break;case 18:t.$message.error((null===n||void 0===n?void 0:n.error)||"取消放行端口失败");case 19:r.next=24;break;case 21:r.prev=21,r.t0=r["catch"](6),t.$message.error("取消放行端口错误: ".concat(r.t0.message));case 24:return r.prev=24,t.loading=!1,r.finish(24);case 27:case"end":return r.stop()}}),r,null,[[6,21,24,27]])})))()},allowIP:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行允许入网操作"),t.abrupt("return");case 3:if(e.ipToAllow){t.next=6;break}return e.$message.warning("请输入要允许的IP地址"),t.abrupt("return");case 6:return t.prev=6,e.loading=!0,t.next=10,e.allowInboundIPsAction({serverId:e.serverId,ips:e.ipToAllow});case 10:if(r=t.sent,!r||!r.success){t.next=19;break}return e.$message.success("成功允许入网IP: ".concat(e.ipToAllow)),e.ipToAllow="",e.invalidateCache("inboundIPs"),t.next=17,e.refreshInboundIPs();case 17:t.next=20;break;case 19:e.$message.error((null===r||void 0===r?void 0:r.error)||"允许入网IP失败");case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](6),e.$message.error("允许入网IP错误: ".concat(t.t0.message));case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[6,22,25,28]])})))()},disallowIP:function(e){var t=this;return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.hasValidServerId){r.next=3;break}return t.$message.error("未指定服务器ID，无法执行取消放行操作"),r.abrupt("return");case 3:if(n="object"===(0,H.A)(e)?e.ip:e,n){r.next=7;break}return t.$message.error("无效的IP地址"),r.abrupt("return");case 7:return r.prev=7,t.loading=!0,r.next=11,t.disallowInboundIPsAction({serverId:t.serverId,ips:n});case 11:if(s=r.sent,!s||!s.success){r.next=19;break}return t.$message.success("成功取消放行IP: ".concat(n)),t.invalidateCache("inboundIPs"),r.next=17,t.refreshInboundIPs();case 17:r.next=20;break;case 19:t.$message.error((null===s||void 0===s?void 0:s.error)||"取消放行IP失败");case 20:r.next=25;break;case 22:r.prev=22,r.t0=r["catch"](7),t.$message.error("取消放行IP错误: ".concat(r.t0.message));case 25:return r.prev=25,t.loading=!1,r.finish(25);case 28:case"end":return r.stop()}}),r,null,[[7,22,25,28]])})))()},confirmClearRules:function(){var e=this;this.hasValidServerId?this.$confirm("此操作将清空所有防火墙规则，是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.clearAllRules()}))["catch"]((function(){e.$message({type:"info",message:"已取消清空操作"})})):this.$message.error("未指定服务器ID，无法执行清除规则操作")},clearAllRules:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行清除规则操作"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,t.next=7,e.clearAllRulesAction(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=22;break}return e.$message.success("成功清除所有规则"),t.next=12,e.clearServerCacheAfterChange();case 12:return t.next=14,e.refreshBlockList();case 14:return t.next=16,e.refreshSSHPort();case 16:return t.next=18,e.refreshInboundPorts();case 18:return t.next=20,e.refreshInboundIPs();case 20:t.next=23;break;case 22:e.$message.error((null===r||void 0===r?void 0:r.error)||"清除所有规则失败");case 23:t.next=28;break;case 25:t.prev=25,t.t0=t["catch"](3),e.$message.error("清除所有规则错误: ".concat(t.t0.message));case 28:return t.prev=28,e.loading=!1,t.finish(28);case 31:case"end":return t.stop()}}),t,null,[[3,25,28,31]])})))()},deployIptatoManually:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行部署操作"),t.abrupt("return");case 3:return t.prev=3,e.deploying=!0,e.commandOutput="正在尝试手动部署脚本...\n",t.next=8,e.$store.dispatch("servers/executeCommand",{serverId:e.serverId,command:"wget -N --no-check-certificate https://raw.githubusercontent.com/Fiftonb/GiPtato/refs/heads/main/iPtato.sh && chmod +x iPtato.sh && bash iPtato.sh"});case 8:if(r=t.sent,!r||!r.success){t.next=37;break}return e.commandOutput+="手动部署命令执行成功，正在验证安装结果...\n",t.next=13,e.$store.dispatch("servers/executeCommand",{serverId:e.serverId,command:'test -f /root/iptato.sh && echo "installed" || echo "not found"'});case 13:if(n=t.sent,!(n&&n.success&&n.data&&n.data.stdout&&n.data.stdout.includes("installed"))){t.next=33;break}return e.commandOutput+="脚本已成功安装!\n",e.$message.success("脚本手动部署成功"),e.initializationSteps[2].done=!0,e.initStepActive=3,t.next=21,e.clearServerCacheAfterChange();case 21:return t.next=23,e.refreshBlockList();case 23:return t.next=25,e.refreshSSHPort();case 25:return t.next=27,e.refreshInboundPorts();case 27:return t.next=29,e.refreshInboundIPs();case 29:e.initializationSteps[3].done=!0,e.isInitialized=!0,t.next=35;break;case 33:e.commandOutput+="脚本安装验证失败，请检查服务器环境或联系管理员\n",e.$message.error("脚本安装验证失败");case 35:t.next=39;break;case 37:e.commandOutput+="手动部署失败: ".concat((null===r||void 0===r?void 0:r.error)||"未知错误","\n"),e.$message.error("手动部署失败");case 39:t.next=45;break;case 41:t.prev=41,t.t0=t["catch"](3),e.commandOutput+="手动部署出错: ".concat(t.t0.message,"\n"),e.$message.error("手动部署出错: ".concat(t.t0.message));case 45:return t.prev=45,e.deploying=!1,t.finish(45);case 48:case"end":return t.stop()}}),t,null,[[3,41,45,48]])})))()},completeInitialization:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法完成初始化"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,e.commandOutput="正在加载规则信息...\n",t.next=8,e.clearServerCacheAfterChange();case 8:return t.next=10,e.refreshBlockList();case 10:return t.next=12,e.refreshSSHPort();case 12:return t.next=14,e.refreshInboundPorts();case 14:return t.next=16,e.refreshInboundIPs();case 16:e.initializationSteps[3].done=!0,e.isInitialized=!0,e.$message.success("初始化完成"),e.commandOutput+="初始化完成，可以开始管理防火墙规则",t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](3),e.commandOutput+="\n初始化过程中加载规则出错: ".concat(t.t0.message),e.$message.error("加载规则失败: ".concat(t.t0.message));case 26:return t.prev=26,e.loading=!1,t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[3,22,26,29]])})))()},clearCommandOutput:function(){this.commandOutput=""},checkScriptExistence:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s,a,o,c,i,u,l,d,p,v;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法检查脚本"),t.abrupt("return");case 3:t.prev=3,e.debugging=!0,e.debugInfo="正在检查脚本存在状态...\n",r=["ls -la /root/iPtato.sh","ls -la /root/iptato.sh",'find /root -name "*.sh" | grep -i iptato','find / -name "*.sh" -type f -not -path "*/\\.*" | grep -i iptato 2>/dev/null'],n=0,s=r;case 8:if(!(n<s.length)){t.next=30;break}return a=s[n],e.debugInfo+="\n执行命令: ".concat(a,"\n"),t.next=13,e.$store.dispatch("servers/executeCommand",{serverId:e.serverId,command:a});case 13:if(o=t.sent,!o||!o.success){t.next=26;break}if(u=(null===(c=o.data)||void 0===c?void 0:c.stdout)||"",l=(null===(i=o.data)||void 0===i?void 0:i.stderr)||"",e.debugInfo+="输出:\n".concat(u,"\n"),l&&(e.debugInfo+="错误:\n".concat(l,"\n")),!u||!u.includes("iPtato.sh")&&!u.includes("iptato.sh")){t.next=24;break}return e.debugInfo+="\n检测到脚本存在！但前端应用未能识别。\n",e.debugInfo+="这可能是脚本命名不一致或路径不同导致的问题。\n",e.$message.warning("脚本已存在但应用无法识别，请参考调试信息"),t.abrupt("break",30);case 24:t.next=27;break;case 26:e.debugInfo+="命令执行失败: ".concat((null===o||void 0===o?void 0:o.error)||"未知错误","\n");case 27:n++,t.next=8;break;case 30:return e.debugInfo+="\n尝试直接执行脚本...\n",t.next=33,e.$store.dispatch("servers/executeCommand",{serverId:e.serverId,command:'cd /root && (./iPtato.sh --help || ./iptato.sh --help || echo "无法执行脚本")'});case 33:d=t.sent,d&&d.success?(v=(null===(p=d.data)||void 0===p?void 0:p.stdout)||"",e.debugInfo+="执行脚本输出:\n".concat(v,"\n"),(v.includes("管理脚本")||v.includes("iptables"))&&(e.debugInfo+="\n脚本可以成功执行！\n",e.debugInfo+="建议使用手动初始化功能完成后续步骤。\n",e.$message.success("脚本可以成功执行，但需要手动初始化"))):e.debugInfo+="脚本执行失败: ".concat((null===d||void 0===d?void 0:d.error)||"未知错误","\n"),t.next=41;break;case 37:t.prev=37,t.t0=t["catch"](3),e.debugInfo+="\n检查过程出错: ".concat(t.t0.message,"\n"),e.$message.error("检查出错: ".concat(t.t0.message));case 41:return t.prev=41,e.debugging=!1,t.finish(41);case 44:case"end":return t.stop()}}),t,null,[[3,37,41,44]])})))()},testServerConnection:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s,a,o,c,i;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法测试连接"),t.abrupt("return");case 3:return t.prev=3,e.debugging=!0,e.debugInfo="正在测试服务器连接...\n",e.debugInfo+="1. 检查服务器信息:\n",t.next=9,e.getServer(e.serverId);case 9:return r=t.sent,r&&r.success?(e.debugInfo+="服务器信息: ".concat(JSON.stringify(r.data,null,2),"\n"),e.debugInfo+="连接状态: ".concat(r.data.status,"\n")):e.debugInfo+="获取服务器信息失败: ".concat((null===r||void 0===r?void 0:r.error)||"未知错误","\n"),e.debugInfo+="\n尝试重新连接服务器...\n",t.prev=12,t.next=15,e.connectServer(e.serverId);case 15:n=t.sent,n&&n.success?e.debugInfo+="服务器重新连接成功\n":e.debugInfo+="服务器重新连接失败: ".concat((null===n||void 0===n?void 0:n.error)||"未知错误","\n"),t.next=22;break;case 19:t.prev=19,t.t0=t["catch"](12),e.debugInfo+="重新连接出错: ".concat(t.t0.message,"\n");case 22:return e.debugInfo+="\n2. 执行简单命令测试:\n",t.next=25,e.$store.dispatch("servers/executeCommand",{serverId:e.serverId,command:"uname -a && whoami && pwd"});case 25:return s=t.sent,s&&s.success?(e.debugInfo+="命令输出:\n".concat((null===(a=s.data)||void 0===a?void 0:a.stdout)||"","\n"),e.debugInfo+="命令成功执行，服务器连接正常\n"):(e.debugInfo+="命令执行失败: ".concat((null===s||void 0===s?void 0:s.error)||"未知错误","\n"),e.debugInfo+="服务器连接可能存在问题\n"),e.debugInfo+="\n3. 检查前后端连接配置:\n",o={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||window.location.origin,e.debugInfo+="API基础URL: ".concat(o,"\n"),e.debugInfo+="当前连接模式: ".concat("production","\n"),e.debugInfo+="\n4. 检查网络连接:\n",t.prev=32,t.next=35,e.$store.dispatch("servers/executeCommand",{serverId:e.serverId,command:"ping -c 3 8.8.8.8"});case 35:c=t.sent,c&&c.success?e.debugInfo+="ping测试结果:\n".concat((null===(i=c.data)||void 0===i?void 0:i.stdout)||"","\n"):e.debugInfo+="ping测试失败: ".concat((null===c||void 0===c?void 0:c.error)||"未知错误","\n"),t.next=42;break;case 39:t.prev=39,t.t1=t["catch"](32),e.debugInfo+="ping测试错误: ".concat(t.t1.message,"\n");case 42:e.$message.info("连接测试完成，请查看调试信息"),t.next=49;break;case 45:t.prev=45,t.t2=t["catch"](3),e.debugInfo+="\n测试过程出错: ".concat(t.t2.message,"\n"),e.$message.error("测试出错: ".concat(t.t2.message));case 49:return t.prev=49,e.debugging=!1,t.finish(49);case 52:case"end":return t.stop()}}),t,null,[[3,45,49,52],[12,19],[32,39]])})))()},resetConnectionState:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法重置状态"),t.abrupt("return");case 3:return t.prev=3,e.debugging=!0,e.debugInfo="正在重置连接状态...\n",t.prev=6,e.debugInfo+="尝试断开当前连接...\n",t.next=10,e.$store.dispatch("servers/executeCommand",{serverId:e.serverId,command:'echo "测试连接状态重置"'});case 10:r=t.sent,e.debugInfo+="断开连接测试命令执行结果: "+(null!==r&&void 0!==r&&r.success?"成功":"失败")+"\n",t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](6),e.debugInfo+="断开连接测试出错: ".concat(t.t0.message,"\n");case 17:return e.debugInfo+="尝试重新连接服务器...\n",t.prev=18,t.next=21,e.connectServer(e.serverId);case 21:n=t.sent,n&&n.success?e.debugInfo+="服务器重新连接成功\n":e.debugInfo+="服务器重新连接失败: ".concat((null===n||void 0===n?void 0:n.error)||"未知错误","\n"),t.next=28;break;case 25:t.prev=25,t.t1=t["catch"](18),e.debugInfo+="重新连接出错: ".concat(t.t1.message,"\n");case 28:return e.resetInitSteps(),e.isInitialized=!1,e.initStepActive=0,t.next=33,e.checkInitialization();case 33:e.debugInfo+="初始化状态已重置，并重新检查\n",e.$message.success("连接状态已重置"),t.next=41;break;case 37:t.prev=37,t.t2=t["catch"](3),e.debugInfo+="\n重置过程出错: ".concat(t.t2.message,"\n"),e.$message.error("重置出错: ".concat(t.t2.message));case 41:return t.prev=41,e.debugging=!1,t.finish(41);case 44:case"end":return t.stop()}}),t,null,[[3,37,41,44],[6,14],[18,25]])})))()},manualInitialize:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法初始化"),t.abrupt("return");case 3:return t.prev=3,e.loading=!0,e.commandOutput="正在手动初始化...\n",e.initializationSteps.forEach((function(e){return e.done=!0})),e.isInitialized=!0,t.next=10,e.clearServerCacheAfterChange();case 10:return t.next=12,e.refreshBlockList();case 12:return t.next=14,e.refreshSSHPort();case 14:return t.next=16,e.refreshInboundPorts();case 16:return t.next=18,e.refreshInboundIPs();case 18:e.commandOutput+="手动初始化完成，已跳过脚本检查\n",e.$message.success("手动初始化完成"),t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](3),e.commandOutput+="\n手动初始化失败: ".concat(t.t0.message,"\n"),e.$message.error("初始化失败: ".concat(t.t0.message));case 26:return t.prev=26,e.loading=!1,t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[3,22,26,29]])})))()},generateManualCommands:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法生成命令"),t.abrupt("return");case 3:try{e.debugging=!0,e.debugInfo="以下是您可以直接在服务器上执行的命令：\n\n",e.debugInfo+="## 1. 部署iPtato脚本\n",e.debugInfo+="```\n",e.debugInfo+="cd ~ && wget -N --no-check-certificate https://raw.githubusercontent.com/Fiftonb/GiPtato/refs/heads/main/iPtato.sh && chmod +x iPtato.sh\n",e.debugInfo+="```\n\n",e.debugInfo+="## 2. 测试iPtato脚本\n",e.debugInfo+="```\n",e.debugInfo+="./iPtato.sh\n",e.debugInfo+="```\n\n",e.debugInfo+="## 3. 常用操作命令\n",e.debugInfo+="```\n",e.debugInfo+="# 阻止BT/PT流量\n",e.debugInfo+="./iPtato.sh 1\n\n",e.debugInfo+="# 解封BT/PT流量\n",e.debugInfo+="./iPtato.sh 11\n\n",e.debugInfo+="# 查看当前封禁列表\n",e.debugInfo+="./iPtato.sh 101\n",e.debugInfo+="```\n\n",e.debugInfo+="## 使用方法\n",e.debugInfo+="1. 通过SSH工具连接到您的服务器\n",e.debugInfo+="2. 复制并粘贴上述命令到SSH终端执行\n",e.debugInfo+='3. 执行完成后，返回此界面点击"跳过检查直接初始化"按钮\n\n',e.debugInfo+='如果您成功执行了这些命令，请点击页面上的"跳过检查直接初始化"按钮，这样可以绕过自动部署和检查过程，直接使用界面管理规则。\n',e.$message.success("已生成手动执行命令，请查看调试信息")}catch(r){e.debugInfo+="\n生成命令过程出错: ".concat(r.message,"\n"),e.$message.error("生成命令出错: ".concat(r.message))}finally{e.debugging=!1}case 4:case"end":return t.stop()}}),t)})))()},deployIptatoScript:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法执行部署操作"),t.abrupt("return");case 3:return t.prev=3,e.deploying=!0,e.commandOutput="正在部署脚本...\n",t.next=8,e.deployIptato(e.serverId);case 8:if(r=t.sent,!r||!r.success){t.next=24;break}return e.$message.success("脚本部署成功"),e.commandOutput+="\n脚本部署成功",t.next=14,e.clearServerCacheAfterChange();case 14:return t.next=16,e.refreshBlockList();case 16:return t.next=18,e.refreshSSHPort();case 18:return t.next=20,e.refreshInboundPorts();case 20:return t.next=22,e.refreshInboundIPs();case 22:t.next=27;break;case 24:n=(null===r||void 0===r?void 0:r.error)||"脚本部署失败",e.$message.error("脚本部署失败: ".concat(n)),e.commandOutput+="\n脚本部署失败: ".concat(n);case 27:t.next=33;break;case 29:t.prev=29,t.t0=t["catch"](3),e.$message.error("脚本部署错误: ".concat(t.t0.message)),e.commandOutput+="\n脚本部署错误: ".concat(t.t0.message);case 33:return t.prev=33,e.deploying=!1,t.finish(33);case 36:case"end":return t.stop()}}),t,null,[[3,29,33,36]])})))()},isSshPort:function(e){if(this.sshPort&&this.sshPort===parseInt(e,10))return!0;if(this.server&&this.server.port===parseInt(e,10))return!0;var t=[22,2222];return t.includes(parseInt(e,10))},startServerStatusCheck:function(){var e=this;this.statusCheckTimer=setInterval((0,$.A)((0,_.A)().mark((function t(){var r,n,s;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.hasValidServerId){t.next=11;break}return t.prev=1,t.next=4,e.getServer(e.serverId);case 4:r=t.sent,r&&r.success&&(n=r.data.status,s=e.server?e.server.status:null,e.server=r.data,"online"!==s&&"online"===n&&e.$message.success("服务器已恢复在线状态"),"online"===s&&"online"!==n&&e.$message.warning("服务器已离线，无法管理防火墙规则")),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.error("检查服务器状态出错:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[1,8]])}))),3e4)},stopServerStatusCheck:function(){this.statusCheckTimer&&(clearInterval(this.statusCheckTimer),this.statusCheckTimer=null)},tryConnectServer:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=3;break}return e.$message.error("未指定服务器ID，无法连接服务器"),t.abrupt("return");case 3:return t.prev=3,e.connecting=!0,e.commandOutput="正在尝试连接服务器...\n",t.next=8,e.connectServer(e.serverId);case 8:r=t.sent,r&&r.success?(e.$message.success("服务器连接成功"),e.commandOutput+="\n服务器连接成功"):(e.$message.error((null===r||void 0===r?void 0:r.error)||"连接服务器失败"),e.commandOutput+="\n连接服务器失败: ".concat((null===r||void 0===r?void 0:r.error)||"未知错误")),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](3),e.$message.error("连接服务器错误: ".concat(t.t0.message)),e.commandOutput+="\n连接服务器错误: ".concat(t.t0.message);case 16:return t.prev=16,e.connecting=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[3,12,16,19]])})))()},invalidateCache:function(e){var t=this;e?(this.cacheTimestamps[e]=0,this.dataLoaded[e]=!1):Object.keys(this.cacheTimestamps).forEach((function(e){t.cacheTimestamps[e]=0,t.dataLoaded[e]=!1}))},loadServerCache:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n,s,a,o,c,i;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=2;break}return t.abrupt("return",!1);case 2:return t.prev=2,t.next=5,e.getCacheLastUpdate(e.serverId);case 5:if(r=t.sent,r.success){t.next=9;break}return console.log("服务器缓存不存在或无法访问"),t.abrupt("return",!1);case 9:return e.serverCacheLastUpdate=r.data.lastUpdate,e.serverCacheAvailable=!0,t.next=13,e.getServerCache(e.serverId);case 13:if(n=t.sent,n.success){t.next=16;break}return t.abrupt("return",!1);case 16:if(s=n.data,s.data.blockList&&(e.blockList=s.data.blockList,e.dataCache.blockList=s.data.blockList,e.cacheTimestamps.blockList=Date.now(),e.dataLoaded.blockList=!0),s.data.sshPortStatus){e.sshPortStatus=s.data.sshPortStatus,e.dataCache.sshPortStatus=s.data.sshPortStatus,e.cacheTimestamps.sshPortStatus=Date.now(),e.dataLoaded.sshPortStatus=!0;try{"string"===typeof s.data.sshPortStatus&&(a=s.data.sshPortStatus.match(/SSH端口\s*[:：]\s*(\d+)/i)||s.data.sshPortStatus.match(/端口\s*[:：]\s*(\d+)/i)||s.data.sshPortStatus.match(/port\s*[:：]\s*(\d+)/i),a&&a[1]&&(e.sshPort=parseInt(a[1],10)))}catch(u){console.error("解析SSH端口出错:",u)}}return s.data.inboundPorts&&(o=s.data.inboundPorts,c=(0,R.A)(new Set([].concat((0,R.A)(o.tcp||[]),(0,R.A)(o.udp||[])))),i=c.map((function(e){return{port:e,protocol:"TCP|UDP"}})),e.inboundPorts=i,e.dataCache.inboundPorts=i,e.cacheTimestamps.inboundPorts=Date.now(),e.dataLoaded.inboundPorts=!0),s.data.inboundIPs&&(e.inboundIPs=Array.isArray(s.data.inboundIPs)?s.data.inboundIPs.map((function(e){return"string"===typeof e?{ip:e}:e})):[],e.dataCache.inboundIPs=e.inboundIPs,e.cacheTimestamps.inboundIPs=Date.now(),e.dataLoaded.inboundIPs=!0),console.log("已成功加载服务器缓存数据"),e.commandOutput="已加载缓存数据",t.abrupt("return",!0);case 26:return t.prev=26,t.t0=t["catch"](2),console.error("加载服务器缓存失败:",t.t0),t.abrupt("return",!1);case 30:case"end":return t.stop()}}),t,null,[[2,26]])})))()},clearServerCacheAfterChange:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e.clearServerCache(e.serverId);case 5:e.serverCacheAvailable=!1,e.serverCacheLastUpdate=null,console.log("服务器缓存已清除"),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](2),console.error("清除服务器缓存失败:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[2,10]])})))()},updateServerCacheItem:function(e,t){var r=this;return(0,$.A)((0,_.A)().mark((function n(){var s,a,o,c;return(0,_.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r.hasValidServerId){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,r.getServerCache(r.serverId);case 5:if(s=n.sent,!s||!s.success){n.next=14;break}return a=s.data,o=(0,i.A)({},a.data),o.data[e]=t,n.next=12,r.$store.dispatch("rules/updateCacheItem",{serverId:r.serverId,key:e,value:t});case 12:c=n.sent,c&&c.success?console.log("服务器缓存项 ".concat(e," 已更新")):console.warn("更新服务器缓存项 ".concat(e," 失败"));case 14:n.next=19;break;case 16:n.prev=16,n.t0=n["catch"](2),console.error("更新服务器缓存项 ".concat(e," 出错:"),n.t0);case 19:r.invalidateCache(e);case 20:case"end":return n.stop()}}),n,null,[[2,16]])})))()},autoResetConnectionState:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r,n;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasValidServerId){t.next=2;break}return t.abrupt("return",!1);case 2:return t.prev=2,e.commandOutput="正在自动重置连接状态...",e.loading=!0,t.next=7,e.connectServer(e.serverId);case 7:if(r=t.sent,!r||!r.success){t.next=17;break}return console.log("服务器重新连接成功"),t.next=12,e.getServer(e.serverId);case 12:return n=t.sent,n&&n.success&&(e.server=n.data),t.abrupt("return",!0);case 17:return console.warn("服务器重新连接失败，将尝试初始化过程"),t.abrupt("return",!1);case 19:t.next=25;break;case 21:return t.prev=21,t.t0=t["catch"](2),console.error("自动重置连接状态失败:",t.t0),t.abrupt("return",!1);case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[2,21,25,28]])})))()}}),watch:{activeTab:function(e,t){var r=this;"outbound"!==e||this.dataLoaded.blockList?"inbound"===e&&(this.dataLoaded.sshPortStatus||this.refreshSSHPort(),this.dataLoaded.inboundPorts||setTimeout((function(){return r.refreshInboundPorts()}),500),this.dataLoaded.inboundIPs||setTimeout((function(){return r.refreshInboundIPs()}),1e3)):this.refreshBlockList()}}},M=N;var q=(0,m.A)(M,z,K,!1,null,"74900e72",null);const j=q.exports;r(25276);var G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container"},[t("el-card",{staticClass:"login-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("h2",[e._v("GiPtato 防火墙管理系统")])]),t("el-form",{ref:"loginForm",attrs:{model:e.loginForm,rules:e.rules,"label-width":"80px"},nativeOn:{submit:function(t){return t.preventDefault(),e.handleLogin.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleLogin}},[e._v("登录")])],1)],1),t("div",{staticClass:"login-tip"},[t("small",[e._v("默认管理员账户：admin / admin123")])])],1)],1)},J=[];const Q={name:"Login",data:function(){return{loginForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:!1}},methods:(0,i.A)((0,i.A)({},(0,u.i0)(["login"])),{},{handleLogin:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.loginForm.validate();case 3:return e.loading=!0,t.next=6,e.login({username:e.loginForm.username,password:e.loginForm.password});case 6:e.$router.push("/"),e.$message.success("登录成功"),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),t.t0.response&&t.t0.response.data?e.$message.error(t.t0.response.data.message||"登录失败"):t.t0.response&&e.$message.error("登录失败，请稍后重试");case 13:return t.prev=13,e.loading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[0,10,13,16]])})))()}}),beforeRouteEnter:function(e,t,r){var n=localStorage.getItem("token");n?r("/"):r()}},W=Q;var X=(0,m.A)(W,G,J,!1,null,"7aa51aaf",null);const Y=X.exports;var Z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"profile-container"},[t("div",{staticClass:"page-header"},[t("div",{staticClass:"header-content"},[t("h1",[e._v("个人资料")]),t("el-button",{attrs:{icon:"el-icon-back"},on:{click:e.goBack}},[e._v("返回")])],1)]),t("el-card",{staticClass:"profile-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("账号信息")])]),t("div",{staticClass:"profile-info"},[t("p",[t("strong",[e._v("用户名:")]),e._v(" "+e._s(e.currentUser.username))]),t("p",[t("strong",[e._v("创建时间:")]),e._v(" "+e._s(e.formatDate(e.currentUser.createdAt)))])])]),t("el-card",{staticClass:"password-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("修改密码")])]),t("change-password-form",{on:{"password-updated":e.onPasswordUpdated}})],1)],1)},ee=[],te=function(){var e=this,t=e._self._c;return t("el-form",{ref:"passwordForm",attrs:{model:e.passwordForm,rules:e.rules,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"当前密码",prop:"currentPassword"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入当前密码"},model:{value:e.passwordForm.currentPassword,callback:function(t){e.$set(e.passwordForm,"currentPassword",t)},expression:"passwordForm.currentPassword"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入新密码"},model:{value:e.passwordForm.newPassword,callback:function(t){e.$set(e.passwordForm,"newPassword",t)},expression:"passwordForm.newPassword"}})],1),t("el-form-item",{attrs:{label:"确认新密码",prop:"confirmPassword"}},[t("el-input",{attrs:{type:"password",placeholder:"请再次输入新密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSubmit.apply(null,arguments)}},model:{value:e.passwordForm.confirmPassword,callback:function(t){e.$set(e.passwordForm,"confirmPassword",t)},expression:"passwordForm.confirmPassword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleSubmit}},[e._v("修改密码")]),t("el-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1)},re=[];const ne={name:"ChangePasswordForm",data:function(){var e=this,t=function(t,r,n){r!==e.passwordForm.newPassword?n(new Error("两次输入的密码不一致")):n()};return{passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},rules:{currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:t,trigger:"blur"}]},loading:!1}},methods:{handleSubmit:function(){var e=this;return(0,$.A)((0,_.A)().mark((function t(){var r;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.passwordForm.validate();case 3:return e.loading=!0,t.next=6,d().put("/api/auth/update-password",{currentPassword:e.passwordForm.currentPassword,newPassword:e.passwordForm.newPassword});case 6:r=t.sent,r.data.success&&(e.$message.success("密码修改成功"),e.resetForm(),e.$emit("password-updated")),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),t.t0.response&&t.t0.response.data?e.$message.error(t.t0.response.data.message||"密码修改失败"):t.t0.response&&e.$message.error("密码修改失败，请稍后重试");case 13:return t.prev=13,e.loading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[0,10,13,16]])})))()},resetForm:function(){this.$refs.passwordForm.resetFields()}}},se=ne;var ae=(0,m.A)(se,te,re,!1,null,"94470f58",null);const oe=ae.exports,ce={name:"Profile",components:{ChangePasswordForm:oe},computed:(0,i.A)({},(0,u.L8)(["currentUser"])),methods:{formatDate:function(e){if(!e)return"未知";var t=new Date(e);return t.toLocaleString()},onPasswordUpdated:function(){this.$message.success("密码已成功更新")},goBack:function(){this.$router.go(-1)}}},ie=ce;var ue=(0,m.A)(ie,Z,ee,!1,null,"57c75397",null);const le=ue.exports;r(50113),r(20116);var de="/api/servers",pe={servers:[],loading:!1,error:null},ve={getAllServers:function(e){return e.servers},getServerById:function(e){return function(t){return e.servers.find((function(e){return e._id===t}))}},getLoading:function(e){return e.loading},getError:function(e){return e.error}},me={getAllServers:function(e){return(0,$.A)((0,_.A)().mark((function t(){var r,n;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.commit,r("setLoading",!0),r("setError",null),t.prev=3,t.next=6,d().get(de);case 6:return n=t.sent,r("setServers",n.data.data),t.abrupt("return",n.data);case 11:throw t.prev=11,t.t0=t["catch"](3),r("setError",t.t0.response?t.t0.response.data.message:t.t0.message),t.t0;case 15:return t.prev=15,r("setLoading",!1),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[3,11,15,18]])})))()},getServer:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().get("".concat(de,"/").concat(t));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},createServer:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=e.dispatch,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post(de,t);case 6:return a=r.sent,r.next=9,s("getAllServers");case 9:return r.abrupt("return",a.data);case 12:throw r.prev=12,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 16:return r.prev=16,n("setLoading",!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[3,12,16,19]])})))()},updateServer:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o,c;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=e.dispatch,a=t.id,o=t.data,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().put("".concat(de,"/").concat(a),o);case 7:return c=r.sent,r.next=10,s("getAllServers");case 10:return r.abrupt("return",c.data);case 13:throw r.prev=13,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 17:return r.prev=17,n("setLoading",!1),r.finish(17);case 20:case"end":return r.stop()}}),r,null,[[4,13,17,20]])})))()},deleteServer:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=e.dispatch,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d()["delete"]("".concat(de,"/").concat(t));case 6:return a=r.sent,r.next=9,s("getAllServers");case 9:return r.abrupt("return",a.data);case 12:throw r.prev=12,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 16:return r.prev=16,n("setLoading",!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[3,12,16,19]])})))()},connectServer:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=e.dispatch,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(de,"/").concat(t,"/connect"));case 6:return a=r.sent,r.next=9,s("getAllServers");case 9:return r.abrupt("return",a.data);case 12:throw r.prev=12,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 16:return r.prev=16,n("setLoading",!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[3,12,16,19]])})))()},disconnectServer:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=e.dispatch,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(de,"/").concat(t,"/disconnect"));case 6:return a=r.sent,r.next=9,s("getAllServers");case 9:return r.abrupt("return",a.data);case 12:throw r.prev=12,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 16:return r.prev=16,n("setLoading",!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[3,12,16,19]])})))()},checkStatus:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setError",null),r.prev=2,r.next=5,d().get("".concat(de,"/").concat(t,"/status"));case 5:return s=r.sent,r.abrupt("return",s.data);case 9:throw r.prev=9,r.t0=r["catch"](2),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 13:case"end":return r.stop()}}),r,null,[[2,9]])})))()},executeCommand:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.command,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(de,"/").concat(s,"/execute"),{command:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},deployIptato:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,e.dispatch,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(de,"/").concat(t,"/deploy"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()}},he={setServers:function(e,t){e.servers=t},setLoading:function(e,t){e.loading=t},setError:function(e,t){e.error=t}};const ge={namespaced:!0,state:pe,getters:ve,actions:me,mutations:he};var fe="/api/rules",be={loading:!1,error:null},we={getLoading:function(e){return e.loading},getError:function(e){return e.error}},ke={getServerCache:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().get("".concat(fe,"/").concat(t,"/cache"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:if(r.prev=10,r.t0=r["catch"](3),!r.t0.response||404!==r.t0.response.status){r.next=14;break}return r.abrupt("return",{success:!1,error:"缓存不存在"});case 14:throw n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 16:return r.prev=16,n("setLoading",!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[3,10,16,19]])})))()},getCacheLastUpdate:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().get("".concat(fe,"/").concat(t,"/cache/last-update"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:if(r.prev=10,r.t0=r["catch"](3),!r.t0.response||404!==r.t0.response.status){r.next=14;break}return r.abrupt("return",{success:!1,error:"缓存不存在"});case 14:throw n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 16:return r.prev=16,n("setLoading",!1),r.finish(16);case 19:case"end":return r.stop()}}),r,null,[[3,10,16,19]])})))()},clearServerCache:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d()["delete"]("".concat(fe,"/").concat(t,"/cache"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},updateCacheItem:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o,c;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.key,o=t.value,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().put("".concat(fe,"/").concat(s,"/cache/").concat(a),{value:o});case 7:return c=r.sent,r.abrupt("return",c.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},getBlockList:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().get("".concat(fe,"/").concat(t,"/blocklist"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},blockBTPTAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/block/bt-pt"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},blockSPAMAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/block/spam"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},blockAllAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/block/all"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},blockCustomPortsAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.ports,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/block/ports"),{ports:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},blockCustomKeywordAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.keyword,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/block/keyword"),{keyword:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},unblockBTPTAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/unblock/bt-pt"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},unblockSPAMAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/unblock/spam"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},unblockAllAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/unblock/all"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},unblockCustomPortsAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.ports,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/unblock/ports"),{ports:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},unblockCustomKeywordAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.keyword,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/unblock/keyword"),{keyword:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},unblockAllKeywordsAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/unblock/all-keywords"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},getInboundPorts:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().get("".concat(fe,"/").concat(t,"/inbound/ports"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},getInboundIPs:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().get("".concat(fe,"/").concat(t,"/inbound/ips"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},allowInboundPortsAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.ports,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/inbound/allow/ports"),{ports:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},disallowInboundPortsAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.ports,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/inbound/disallow/ports"),{ports:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},allowInboundIPsAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.ips,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/inbound/allow/ips"),{ips:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},disallowInboundIPsAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,s=t.serverId,a=t.ips,n("setLoading",!0),n("setError",null),r.prev=4,r.next=7,d().post("".concat(fe,"/").concat(s,"/inbound/disallow/ips"),{ips:a});case 7:return o=r.sent,r.abrupt("return",o.data);case 11:throw r.prev=11,r.t0=r["catch"](4),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 15:return r.prev=15,n("setLoading",!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[4,11,15,18]])})))()},getSSHPort:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().get("".concat(fe,"/").concat(t,"/ssh-port"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()},clearAllRulesAction:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("setLoading",!0),n("setError",null),r.prev=3,r.next=6,d().post("".concat(fe,"/").concat(t,"/clear-all"));case 6:return s=r.sent,r.abrupt("return",s.data);case 10:throw r.prev=10,r.t0=r["catch"](3),n("setError",r.t0.response?r.t0.response.data.message:r.t0.message),r.t0;case 14:return r.prev=14,n("setLoading",!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[3,10,14,17]])})))()}},xe={setLoading:function(e,t){e.loading=t},setError:function(e,t){e.error=t}};const Ae={namespaced:!0,state:be,getters:we,actions:ke,mutations:xe};var Ie={token:localStorage.getItem("token")||null,user:null,loading:!1},Se={isAuthenticated:function(e){return!!e.token},currentUser:function(e){return e.user},isLoading:function(e){return e.loading}},Pe={login:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o,c;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,n("SET_LOADING",!0),r.prev=2,r.next=5,d().post("/api/auth/login",t);case 5:return s=r.sent,a=s.data.data,o=a.token,c=a.user,localStorage.setItem("token",o),n("SET_TOKEN",o),n("SET_USER",c),d().defaults.headers.common["Authorization"]="Bearer ".concat(o),r.abrupt("return",s);case 14:throw r.prev=14,r.t0=r["catch"](2),n("SET_TOKEN",null),n("SET_USER",null),localStorage.removeItem("token"),r.t0;case 20:return r.prev=20,n("SET_LOADING",!1),r.finish(20);case 23:case"end":return r.stop()}}),r,null,[[2,14,20,23]])})))()},register:function(e,t){return(0,$.A)((0,_.A)().mark((function r(){var n,s,a,o,c;return(0,_.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,e.dispatch,n("SET_LOADING",!0),r.prev=2,r.next=5,d().post("/api/auth/register",t);case 5:return s=r.sent,a=s.data.data,o=a.token,c=a.user,localStorage.setItem("token",o),n("SET_TOKEN",o),n("SET_USER",c),d().defaults.headers.common["Authorization"]="Bearer ".concat(o),r.abrupt("return",s);case 14:throw r.prev=14,r.t0=r["catch"](2),n("SET_TOKEN",null),n("SET_USER",null),localStorage.removeItem("token"),r.t0;case 20:return r.prev=20,n("SET_LOADING",!1),r.finish(20);case 23:case"end":return r.stop()}}),r,null,[[2,14,20,23]])})))()},getCurrentUser:function(e){return(0,$.A)((0,_.A)().mark((function t(){var r,n,s;return(0,_.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.commit,n=e.state,n.token){t.next=3;break}return t.abrupt("return");case 3:return r("SET_LOADING",!0),t.prev=4,t.next=7,d().get("/api/auth/me");case 7:return s=t.sent,r("SET_USER",s.data.data.user),t.abrupt("return",s);case 12:throw t.prev=12,t.t0=t["catch"](4),t.t0.response&&401===t.t0.response.status&&(r("SET_TOKEN",null),r("SET_USER",null),localStorage.removeItem("token")),t.t0;case 16:return t.prev=16,r("SET_LOADING",!1),t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[4,12,16,19]])})))()},logout:function(e){var t=e.commit;t("SET_TOKEN",null),t("SET_USER",null),localStorage.removeItem("token"),delete d().defaults.headers.common["Authorization"]}},ye={SET_TOKEN:function(e,t){e.token=t},SET_USER:function(e,t){e.user=t},SET_LOADING:function(e,t){e.loading=t}};const _e={state:Ie,getters:Se,actions:Pe,mutations:ye};n["default"].use(u.Ay);const $e=new u.Ay.Store({modules:{servers:ge,rules:Ae,auth:_e}});n["default"].use(f.Ay);var Ce=[{path:"/",name:"home",component:I,meta:{requiresAuth:!0}},{path:"/servers",name:"servers",component:V,meta:{requiresAuth:!0}},{path:"/rules/:serverId",name:"rules",component:j,props:!0,meta:{requiresAuth:!0}},{path:"/profile",name:"profile",component:le,meta:{requiresAuth:!0}},{path:"/login",name:"login",component:Y}],Le=new f.Ay({mode:"history",base:"/",routes:Ce});Le.beforeEach((function(e,t,r){var n=e.matched.some((function(e){return e.meta.requiresAuth})),s=$e.getters.isAuthenticated;n&&!s?r("/login"):r()}));const Te=Le;d().defaults.baseURL={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"",d().interceptors.response.use((function(e){return e}),(function(e){return e.response&&401===e.response.status&&($e.dispatch("logout"),Te.push("/login")),Promise.reject(e)}));var Ee=localStorage.getItem("token");Ee&&(d().defaults.headers.common["Authorization"]="Bearer ".concat(Ee)),n["default"].prototype.$http=d(),n["default"].use(a()),n["default"].config.productionTip=!1,new n["default"]({router:Te,store:$e,render:function(e){return e(g)}}).$mount("#app")}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}r.m=e,(()=>{r.amdO={}})(),(()=>{var e=[];r.O=(t,n,s,a)=>{if(!n){var o=1/0;for(l=0;l<e.length;l++){for(var[n,s,a]=e[l],c=!0,i=0;i<n.length;i++)(!1&a||o>=a)&&Object.keys(r.O).every((e=>r.O[e](n[i])))?n.splice(i--,1):(c=!1,a<o&&(o=a));if(c){e.splice(l--,1);var u=s();void 0!==u&&(t=u)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,s,a]}})(),(()=>{r.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return r.d(t,{a:t}),t}})(),(()=>{r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{var e={524:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var s,a,[o,c,i]=n,u=0;if(o.some((t=>0!==e[t]))){for(s in c)r.o(c,s)&&(r.m[s]=c[s]);if(i)var l=i(r)}for(t&&t(n);u<o.length;u++)a=o[u],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(l)},n=self["webpackChunkiptato_panel_client"]=self["webpackChunkiptato_panel_client"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=r.O(void 0,[504],(()=>r(9618)));n=r.O(n)})();
//# sourceMappingURL=app.787b72d1.js.map